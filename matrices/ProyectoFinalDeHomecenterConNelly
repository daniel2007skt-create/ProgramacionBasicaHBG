#include <stdio.h>
#include <string.h>
#include <ctype.h>

#define FILAS 3
#define COLUMNAS 3
#define MAX 40

char estanteA[FILAS][COLUMNAS][MAX] = {
    {"ladrillo",  "cemento",  "pintura"},
    {"pegante",   "yeso",     "arena"},
    {"bloquelon", "varilla",  "tubos pvc"}
};

char estanteB[FILAS][COLUMNAS][MAX] = {
    {"martillo",  "taladro",     "brocas"},
    {"serrucho",  "metrica",     "escalera"},
    {"guantes",   "silicona",    "cables"}
};

char estanteC[FILAS][COLUMNAS][MAX] = {
    {"jabon",     "escoba",     "cloro"},
    {"trapero",   "balde",      "limpiavidrio"},
    {"esponja",   "detergente", "ambientador"}
};

char estanteD[FILAS][COLUMNAS][MAX] = {
    {"licuadora", "tostadora",  "cafetera"},
    {"microondas","batidora",   "plancha"},
    {"ventilador","televisor",  "parlante"}
};

int preciosA[FILAS][COLUMNAS] = {
    {800, 32500, 15000},
    {8000, 12000, 5000},
    {25000, 18000, 9000}
};

int preciosB[FILAS][COLUMNAS] = {
    {10000, 20000, 15000},
    {8000, 12000, 5000},
    {25000, 18000, 9000}
};

int preciosC[FILAS][COLUMNAS] = {
    {10000, 20000, 15000},
    {8000, 12000, 5000},
    {25000, 18000, 9000}
};

int preciosD[FILAS][COLUMNAS] = {
    {10000, 20000, 15000},
    {8000, 12000, 5000},
    {25000, 18000, 9000}
};

int stricmp_compat(const char *a, const char *b) {
    while (*a != '\0' && *b != '\0') {
        char ca = tolower((unsigned char)*a);
        char cb = tolower((unsigned char)*b);
        if (ca != cb) return (unsigned char)ca - (unsigned char)cb;
        a++; b++;
    }
    return (unsigned char)tolower((unsigned char)*a) - (unsigned char)tolower((unsigned char)*b);
}

int buscar_en(char est[FILAS][COLUMNAS][MAX], const char prod[], const char nombreEstante[]) {
	int f;
	int c;
    for (f = 0; f < FILAS; f++) {
        for (c = 0; c < COLUMNAS; c++) {
            if (stricmp_compat(prod, est[f][c]) == 0) {
                printf("\n? Producto encontrado en %s\n", nombreEstante);
                printf("  Fila: %d   Columna: %d\n\n", f + 1, c + 1);
                return 1;
            }
        }
    }
    return 0;
}

void mostrar_precio() {
    char prod[MAX];
    printf("\nIngrese producto para ver su precio: ");

    if (fgets(prod, sizeof(prod), stdin) == NULL) {
        printf("\nError leyendo entrada.\n");
        return;
    }

    size_t len = strlen(prod);
    if (len > 0 && prod[len - 1] == '\n') prod[len - 1] = '\0';

    int f, c;

    for (f = 0; f < FILAS; f++) {
        for (c = 0; c < COLUMNAS; c++) {
            if (stricmp_compat(prod, estanteA[f][c]) == 0) {
                printf("\nPrecio de %s: %d\n", prod, preciosA[f][c]);
                return;
            }
        }
    }

    for (f = 0; f < FILAS; f++) {
        for (c = 0; c < COLUMNAS; c++) {
            if (stricmp_compat(prod, estanteB[f][c]) == 0) {
                printf("\nPrecio de %s: %d\n", prod, preciosB[f][c]);
                return;
            }
        }
    }

    for (f = 0; f < FILAS; f++) {
        for (c = 0; c < COLUMNAS; c++) {
            if (stricmp_compat(prod, estanteC[f][c]) == 0) {
                printf("\nPrecio de %s: %d\n", prod, preciosC[f][c]);
                return;
            }
        }
    }

    for (f = 0; f < FILAS; f++) {
        for (c = 0; c < COLUMNAS; c++) {
            if (stricmp_compat(prod, estanteD[f][c]) == 0) {
                printf("\nPrecio de %s: %d\n", prod, preciosD[f][c]);
                return;
            }
        }
    }

    printf("\n? Producto NO encontrado.\n");
}

void ver_tienda() {
    printf("\n             			  ///////////////// | HOMECENTER | ////////////////// \n\n");

    printf("	<<< ESTANTE A >>>  								<<< ESTANTE B >>> \n\n");
	printf("/ (Productos de Construccion) / 	  	    	PASILLO  	               / (Herramientas) /\n");
    printf("----------------------------------------------------------------------------------------------------------------------\n");
    int f;
    int c;
    for (f = 0; f < FILAS; f++) {
        for (c = 0; c < COLUMNAS; c++) {
            printf("| %-12s ", estanteA[f][c]);
        }
        printf("|   >>>>>> PASILLO >>>>>>   |");
        for (c = 0; c < COLUMNAS; c++) {
            printf(" %-12s |", estanteB[f][c]);
        }
        printf("\n");
    }
    printf("----------------------------------------------------------------------------------------------------------------------\n\n");

    printf("	<<< ESTANTE C >>>  								<<< ESTANTE D >>> \n\n");
	printf("/ (Productos de Aseo) / 	  	    		PASILLO  	               / (Electrodomesticos) /\n");
    printf("----------------------------------------------------------------------------------------------------------------------\n");

    for (f = 0; f < FILAS; f++) {
        for (c = 0; c < COLUMNAS; c++) {
            printf("| %-12s ", estanteC[f][c]);
        }
        printf("|   >>>>>> PASILLO >>>>>>   |");
        for (c = 0; c < COLUMNAS; c++) {
            printf(" %-12s |", estanteD[f][c]);
        }
        printf("\n");
    }
    printf("----------------------------------------------------------------------------------------------------------------------\n\n");
}

void limpiar_linea_stdin(void) {
    int ch;
    while ((ch = getchar()) != '\n' && ch != EOF) { }
}

void buscar() {
    char prod[MAX];

    printf("\nIngrese producto a buscar (no importa mayusculas/minusculas): ");

    if (fgets(prod, sizeof(prod), stdin) == NULL) {
        printf("\nError leyendo entrada.\n");
        return;
    }

    size_t len = strlen(prod);
    if (len > 0 && prod[len - 1] == '\n') prod[len - 1] = '\0';

    if (buscar_en(estanteA, prod, "Estante A (Construccion)")) return;
    if (buscar_en(estanteB, prod, "Estante B (Herramientas)")) return;
    if (buscar_en(estanteC, prod, "Estante C (Aseo)")) return;
    if (buscar_en(estanteD, prod, "Estante D (Electrodomesticos)")) return;

    printf("\n? Producto NO encontrado.\n");
}

int main() {
    int op = 0;

    do {
        printf("\n  ========== MENU ========== \n");
        printf("1. Ver estanterias completas\n");
        printf("2. Buscar producto\n");
        printf("3. Salir\n");
        printf("4. Mostrar precio\n");
        printf("Seleccione opcion: ");

        if (scanf("%d", &op) != 1) {
            printf("\nEntrada invalida.\n");
            limpiar_linea_stdin();
            continue;
        }

        limpiar_linea_stdin();

        switch (op) {
            case 1: ver_tienda(); break;
            case 2: buscar(); break;
            case 3: printf("\nSaliendo...\n"); break;
            case 4: mostrar_precio(); break;
            default: printf("\nOpcion invalida.\n");
        }

    } while (op != 3);

    return 0;
}
